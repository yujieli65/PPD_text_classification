<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <title>PDD Classification Predictor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Animate.css CDN for complex animations -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <!-- Feather Icons for SVG icons -->
  <script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="bg-gradient-to-r from-blue-100 via-indigo-100 to-purple-100 min-h-screen flex flex-col items-center p-6 font-sans">

  <header class="max-w-3xl w-full text-center mb-10">
    <h1 class="text-4xl font-extrabold text-indigo-700 mb-4 animate__animated animate__fadeInDown">PDD Classification Predictor</h1>
    <p class="text-indigo-600 text-lg max-w-xl mx-auto animate__animated animate__fadeInDown animate__delay-1s">
      Enter any text and our AI model will classify it into one of three categories. Powered by FastAPI, PyTorch, and HuggingFace Transformers for fast and accurate predictions.
    </p>
  </header>

  <main class="bg-white max-w-3xl w-full rounded-xl shadow-lg p-8 flex flex-col gap-8 animate__animated animate__fadeInUp">

    <textarea id="textInput" rows="6" placeholder="Type or paste your text here..." 
      class="w-full border border-indigo-300 rounded-md p-4 resize-y focus:outline-none focus:ring-4 focus:ring-indigo-400 transition"></textarea>

    <button id="predictBtn" 
      class="bg-indigo-600 text-white py-3 rounded-lg font-semibold shadow-md hover:bg-indigo-700 active:scale-95 transition-transform flex justify-center items-center gap-2">
      <svg id="loadingIcon" class="hidden animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
      </svg>
      <span id="btnText">Predict</span>
    </button>

    <section id="result" class="min-h-[4rem]"></section>

    <section class="text-center space-y-4">
      <h2 class="text-2xl font-bold text-indigo-700">Category Labels Explanation</h2>
      <div class="flex justify-center gap-8 flex-wrap">
        <div class="flex items-center gap-2 animate__animated animate__fadeInLeft animate__delay-1s">
          <span class="w-6 h-6 rounded-full bg-green-400 border-2 border-green-600 inline-block"></span>
          <span class="text-green-700 font-semibold">Class 0:</span> Positive / Approved / Accept
        </div>
        <div class="flex items-center gap-2 animate__animated animate__fadeInLeft animate__delay-1_5s">
          <span class="w-6 h-6 rounded-full bg-yellow-400 border-2 border-yellow-600 inline-block"></span>
          <span class="text-yellow-700 font-semibold">Class 1:</span> Neutral / Pending / Review
        </div>
        <div class="flex items-center gap-2 animate__animated animate__fadeInLeft animate__delay-2s">
          <span class="w-6 h-6 rounded-full bg-red-400 border-2 border-red-600 inline-block"></span>
          <span class="text-red-700 font-semibold">Class 2:</span> Negative / Rejected / Denied
        </div>
      </div>
    </section>

    <div id="error" class="text-red-600 font-medium text-center mt-4"></div>
  </main>

  <script>
    const predictBtn = document.getElementById("predictBtn");
    const textInput = document.getElementById("textInput");
    const resultSection = document.getElementById("result");
    const errorDiv = document.getElementById("error");
    const loadingIcon = document.getElementById("loadingIcon");
    const btnText = document.getElementById("btnText");

    function createResultCard(type) {
      // Map class to color, icon and label text
      let color, iconSVG, label;
      switch(type) {
        case 0:
          color = "bg-green-100 text-green-800 border-green-300";
          iconSVG = `<svg xmlns="http://www.w3.org/2000/svg" class="inline h-7 w-7 mr-3 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>`;
          label = "Class 0 — Positive / Approved / Accept";
          break;
        case 1:
          color = "bg-yellow-100 text-yellow-800 border-yellow-300";
          iconSVG = `<svg xmlns="http://www.w3.org/2000/svg" class="inline h-7 w-7 mr-3 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01"/></svg>`;
          label = "Class 1 — Neutral / Pending / Review";
          break;
        case 2:
          color = "bg-red-100 text-red-800 border-red-300";
          iconSVG = `<svg xmlns="http://www.w3.org/2000/svg" class="inline h-7 w-7 mr-3 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>`;
          label = "Class 2 — Negative / Rejected / Denied";
          break;
        default:
          color = "bg-gray-100 text-gray-800 border-gray-300";
          iconSVG = "";
          label = "Unknown category";
      }

      return `
        <div class="max-w-md mx-auto border ${color} rounded-xl p-5 flex items-center shadow-lg animate__animated animate__bounceIn">
          ${iconSVG}
          <span class="text-xl font-semibold">${label}</span>
        </div>
      `;
    }

    predictBtn.addEventListener("click", async () => {
      const text = textInput.value.trim();
      resultSection.innerHTML = "";
      errorDiv.textContent = "";

      if (!text) {
        errorDiv.textContent = "Please enter text before predicting.";
        return;
      }

      predictBtn.disabled = true;
      loadingIcon.classList.remove("hidden");
      btnText.textContent = "Predicting...";

      try {
        const response = await fetch("/predict/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text })
        });

        if (!response.ok) throw new Error("Server error: " + response.statusText);

        const data = await response.json();

        // 只显示分类，不展示原文
        resultSection.innerHTML = createResultCard(data.prediction);
      } catch (err) {
        errorDiv.textContent = "Request failed: " + err.message;
      } finally {
        predictBtn.disabled = false;
        loadingIcon.classList.add("hidden");
        btnText.textContent = "Predict";
      }
    });

    // 启动 feather icons
    feather.replace();
  </script>
</body>
</html>
